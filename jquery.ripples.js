/*!
 * jQuery Ripples plugin v0.5.3 / https://github.com/sirxemic/jquery.ripples
 * MIT License
 * @author sirxemic / https://sirxemic.com/
 */
(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{if(typeof exports==="object"){a(require("jquery"))}else{a(jQuery)}}}(function(i){var l;var b=i(window);function o(p){return p[p.length-1]=="%"}function n(){var r=document.createElement("canvas");l=r.getContext("webgl")||r.getContext("experimental-webgl");if(!l){return null}var t={};["OES_texture_float","OES_texture_half_float","OES_texture_float_linear","OES_texture_half_float_linear"].forEach(function(x){var y=l.getExtension(x);if(y){t[x]=y}});if(!t.OES_texture_float){return null}var w=[];function p(A,C){var y="OES_texture_"+A,x=y+"_linear",z=x in t,B=[y];if(z){B.push(x)}return{type:C,linearSupport:z,extensions:B}}w.push(p("float",l.FLOAT));if(t.OES_texture_half_float){w.push(p("half_float",t.OES_texture_half_float.HALF_FLOAT_OES))}var u=l.createTexture();var v=l.createFramebuffer();l.bindFramebuffer(l.FRAMEBUFFER,v);l.bindTexture(l.TEXTURE_2D,u);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE);var q=null;for(var s=0;s<w.length;s++){l.texImage2D(l.TEXTURE_2D,0,l.RGBA,32,32,0,l.RGBA,w[s].type,null);l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,u,0);if(l.checkFramebufferStatus(l.FRAMEBUFFER)===l.FRAMEBUFFER_COMPLETE){q=w[s];break}}return q}function h(r,p){try{return new ImageData(r,p)}catch(s){var q=document.createElement("canvas");return q.getContext("2d").createImageData(r,p)}}function g(p){var q=p.split(" ");if(q.length===1){switch(p){case"center":return["50%","50%"];case"top":return["50%","0"];case"bottom":return["50%","100%"];case"left":return["0","50%"];case"right":return["100%","50%"];default:return[p,"50%"]}}else{return q.map(function(r){switch(p){case"center":return"50%";case"top":case"left":return"0";case"right":case"bottom":return"100%";default:return r}})}}function e(r,x,q){function u(y,A){var z=l.createShader(y);l.shaderSource(z,A);l.compileShader(z);if(!l.getShaderParameter(z,l.COMPILE_STATUS)){throw new Error("compile error: "+l.getShaderInfoLog(z))}return z}var s={};s.id=l.createProgram();l.attachShader(s.id,u(l.VERTEX_SHADER,r));l.attachShader(s.id,u(l.FRAGMENT_SHADER,x));l.linkProgram(s.id);if(!l.getProgramParameter(s.id,l.LINK_STATUS)){throw new Error("link error: "+l.getProgramInfoLog(s.id))}s.uniforms={};s.locations={};l.useProgram(s.id);l.enableVertexAttribArray(0);var t,p,w=/uniform (\w+) (\w+)/g,v=r+x;while((t=w.exec(v))!=null){p=t[2];s.locations[p]=l.getUniformLocation(s.id,p)}return s}function k(q,p){l.activeTexture(l.TEXTURE0+(p||0));l.bindTexture(l.TEXTURE_2D,q)}function j(q){var p=/url\(["']?([^"']*)["']?\)/.exec(q);if(p==null){return null}return p[1]}function f(p){return p.match(/^data:/)}var d=n();var m=h(32,32);i("head").prepend("<style>.jquery-ripples { position: relative; z-index: 0; }</style>");var a=function(s,q){var v=this;this.$el=i(s);this.interactive=q.interactive;this.resolution=q.resolution;this.textureDelta=new Float32Array([1/this.resolution,1/this.resolution]);this.perturbance=q.perturbance;this.dropRadius=q.dropRadius;this.crossOrigin=q.crossOrigin;this.imageUrl=q.imageUrl;var p=document.createElement("canvas");p.width=this.$el.innerWidth();p.height=this.$el.innerHeight();this.canvas=p;this.$canvas=i(p);this.$canvas.css({position:"absolute",left:0,top:0,right:0,bottom:0,zIndex:-1});this.$el.addClass("jquery-ripples").append(p);this.context=l=p.getContext("webgl")||p.getContext("experimental-webgl");d.extensions.forEach(function(x){l.getExtension(x)});i(window).on("resize",function(){var y=v.$el.innerWidth(),x=v.$el.innerHeight();if(y!=v.canvas.width||x!=v.canvas.height){p.width=y;p.height=x}});this.textures=[];this.framebuffers=[];this.bufferWriteIndex=0;this.bufferReadIndex=1;for(var r=0;r<2;r++){var u=l.createTexture();var w=l.createFramebuffer();l.bindFramebuffer(l.FRAMEBUFFER,w);w.width=this.resolution;w.height=this.resolution;l.bindTexture(l.TEXTURE_2D,u);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,d.linearSupport?l.LINEAR:l.NEAREST);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,d.linearSupport?l.LINEAR:l.NEAREST);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE);l.texImage2D(l.TEXTURE_2D,0,l.RGBA,this.resolution,this.resolution,0,l.RGBA,d.type,null);l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,u,0);this.textures.push(u);this.framebuffers.push(w)}this.quad=l.createBuffer();l.bindBuffer(l.ARRAY_BUFFER,this.quad);l.bufferData(l.ARRAY_BUFFER,new Float32Array([-1,-1,+1,-1,+1,+1,-1,+1]),l.STATIC_DRAW);this.initShaders();this.initTexture();this.setTransparentTexture();this.loadImage();l.clearColor(0,0,0,0);l.blendFunc(l.SRC_ALPHA,l.ONE_MINUS_SRC_ALPHA);this.visible=true;this.running=true;this.inited=true;this.setupPointerEvents();function t(){v.step();requestAnimationFrame(t)}requestAnimationFrame(t)};a.DEFAULTS={imageUrl:null,resolution:256,dropRadius:20,perturbance:0.03,interactive:true,crossOrigin:""};a.prototype={setupPointerEvents:function(){var q=this;function r(){return q.visible&&q.running&&q.interactive}function p(t,s){if(r()){q.dropAtPointer(t,q.dropRadius*(s?1.5:1),(s?0.14:0.01))}}this.$el.on("mousemove.ripples",function(s){p(s)}).on("touchmove.ripples, touchstart.ripples",function(u){var t=u.originalEvent.changedTouches;for(var s=0;s<t.length;s++){p(t[s])}}).on("mousedown.ripples",function(s){p(s,true)})},loadImage:function(){var p=this;l=this.context;var r=this.imageUrl||j(this.originalCssBackgroundImage)||j(this.$el.css("backgroundImage"));if(r==this.imageSource){return}this.imageSource=r;if(!this.imageSource){this.setTransparentTexture();return}var q=new Image;q.onload=function(){l=p.context;function s(u){return(u&(u-1))==0}var t=(s(q.width)&&s(q.height))?l.REPEAT:l.CLAMP_TO_EDGE;l.bindTexture(l.TEXTURE_2D,p.backgroundTexture);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,t);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,t);l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,q);p.backgroundWidth=q.width;p.backgroundHeight=q.height;p.hideCssBackground()};q.onerror=function(){l=p.context;p.setTransparentTexture()};q.crossOrigin=f(this.imageSource)?null:this.crossOrigin;q.src=this.imageSource},step:function(){l=this.context;if(!this.visible){return}this.computeTextureBoundaries();if(this.running){this.update()}this.render()},drawQuad:function(){l.bindBuffer(l.ARRAY_BUFFER,this.quad);l.vertexAttribPointer(0,2,l.FLOAT,false,0,0);l.drawArrays(l.TRIANGLE_FAN,0,4)},render:function(){l.bindFramebuffer(l.FRAMEBUFFER,null);l.viewport(0,0,this.canvas.width,this.canvas.height);l.enable(l.BLEND);l.clear(l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT);l.useProgram(this.renderProgram.id);k(this.backgroundTexture,0);k(this.textures[0],1);l.uniform1f(this.renderProgram.locations.perturbance,this.perturbance);l.uniform2fv(this.renderProgram.locations.topLeft,this.renderProgram.uniforms.topLeft);l.uniform2fv(this.renderProgram.locations.bottomRight,this.renderProgram.uniforms.bottomRight);l.uniform2fv(this.renderProgram.locations.containerRatio,this.renderProgram.uniforms.containerRatio);l.uniform1i(this.renderProgram.locations.samplerBackground,0);l.uniform1i(this.renderProgram.locations.samplerRipples,1);this.drawQuad();l.disable(l.BLEND)},update:function(){l.viewport(0,0,this.resolution,this.resolution);l.bindFramebuffer(l.FRAMEBUFFER,this.framebuffers[this.bufferWriteIndex]);k(this.textures[this.bufferReadIndex]);l.useProgram(this.updateProgram.id);this.drawQuad();this.swapBufferIndices()},swapBufferIndices:function(){this.bufferWriteIndex=1-this.bufferWriteIndex;this.bufferReadIndex=1-this.bufferReadIndex},computeTextureBoundaries:function(){var z=this.$el.css("background-size");var x=this.$el.css("background-attachment");var r=g(this.$el.css("background-position"));var q;if(x=="fixed"){q={left:window.pageXOffset,top:window.pageYOffset};q.width=b.width();q.height=b.height()}else{q=this.$el.offset();q.width=this.$el.innerWidth();q.height=this.$el.innerHeight()}if(z=="cover"){var t=Math.max(q.width/this.backgroundWidth,q.height/this.backgroundHeight);var v=this.backgroundWidth*t;var s=this.backgroundHeight*t}else{if(z=="contain"){var t=Math.min(q.width/this.backgroundWidth,q.height/this.backgroundHeight);var v=this.backgroundWidth*t;var s=this.backgroundHeight*t}else{z=z.split(" ");var v=z[0]||"";var s=z[1]||v;if(o(v)){v=q.width*parseFloat(v)/100}else{if(v!="auto"){v=parseFloat(v)}}if(o(s)){s=q.height*parseFloat(s)/100}else{if(s!="auto"){s=parseFloat(s)}}if(v=="auto"&&s=="auto"){v=this.backgroundWidth;s=this.backgroundHeight}else{if(v=="auto"){v=this.backgroundWidth*(s/this.backgroundHeight)}if(s=="auto"){s=this.backgroundHeight*(v/this.backgroundWidth)}}}}var y=r[0];var w=r[1];if(o(y)){y=q.left+(q.width-v)*parseFloat(y)/100}else{y=q.left+parseFloat(y)}if(o(w)){w=q.top+(q.height-s)*parseFloat(w)/100}else{w=q.top+parseFloat(w)}var p=this.$el.offset();this.renderProgram.uniforms.topLeft=new Float32Array([(p.left-y)/v,(p.top-w)/s]);this.renderProgram.uniforms.bottomRight=new Float32Array([this.renderProgram.uniforms.topLeft[0]+this.$el.innerWidth()/v,this.renderProgram.uniforms.topLeft[1]+this.$el.innerHeight()/s]);var u=Math.max(this.canvas.width,this.canvas.height);this.renderProgram.uniforms.containerRatio=new Float32Array([this.canvas.width/u,this.canvas.height/u])},initShaders:function(){var p=["attribute vec2 vertex;","varying vec2 coord;","void main() {","coord = vertex * 0.5 + 0.5;","gl_Position = vec4(vertex, 0.0, 1.0);","}"].join("\n");this.dropProgram=e(p,["precision highp float;","const float PI = 3.141592653589793;","uniform sampler2D texture;","uniform vec2 center;","uniform float radius;","uniform float strength;","varying vec2 coord;","void main() {","vec4 info = texture2D(texture, coord);","float drop = max(0.0, 1.0 - length(center * 0.5 + 0.5 - coord) / radius);","drop = 0.5 - cos(drop * PI) * 0.5;","info.r += drop * strength;","gl_FragColor = info;","}"].join("\n"));this.updateProgram=e(p,["precision highp float;","uniform sampler2D texture;","uniform vec2 delta;","varying vec2 coord;","void main() {","vec4 info = texture2D(texture, coord);","vec2 dx = vec2(delta.x, 0.0);","vec2 dy = vec2(0.0, delta.y);","float average = (","texture2D(texture, coord - dx).r +","texture2D(texture, coord - dy).r +","texture2D(texture, coord + dx).r +","texture2D(texture, coord + dy).r",") * 0.25;","info.g += (average - info.r) * 2.0;","info.g *= 0.995;","info.r += info.g;","gl_FragColor = info;","}"].join("\n"));l.uniform2fv(this.updateProgram.locations.delta,this.textureDelta);this.renderProgram=e(["precision highp float;","attribute vec2 vertex;","uniform vec2 topLeft;","uniform vec2 bottomRight;","uniform vec2 containerRatio;","varying vec2 ripplesCoord;","varying vec2 backgroundCoord;","void main() {","backgroundCoord = mix(topLeft, bottomRight, vertex * 0.5 + 0.5);","backgroundCoord.y = 1.0 - backgroundCoord.y;","ripplesCoord = vec2(vertex.x, -vertex.y) * containerRatio * 0.5 + 0.5;","gl_Position = vec4(vertex.x, -vertex.y, 0.0, 1.0);","}"].join("\n"),["precision highp float;","uniform sampler2D samplerBackground;","uniform sampler2D samplerRipples;","uniform vec2 delta;","uniform float perturbance;","varying vec2 ripplesCoord;","varying vec2 backgroundCoord;","void main() {","float height = texture2D(samplerRipples, ripplesCoord).r;","float heightX = texture2D(samplerRipples, vec2(ripplesCoord.x + delta.x, ripplesCoord.y)).r;","float heightY = texture2D(samplerRipples, vec2(ripplesCoord.x, ripplesCoord.y + delta.y)).r;","vec3 dx = vec3(delta.x, heightX - height, 0.0);","vec3 dy = vec3(0.0, heightY - height, delta.y);","vec2 offset = -normalize(cross(dy, dx)).xz;","float specularFactor = pow(max(0.0, dot(offset, normalize(vec2(-0.1, 1.0)))), 4.0);","vec4 specular = vec4(0, 0, 0, 0) * specularFactor;","gl_FragColor = texture2D(samplerBackground, backgroundCoord + offset * perturbance) + specular;","}"].join("\n"));l.uniform2fv(this.renderProgram.locations.delta,this.textureDelta)},initTexture:function(){this.backgroundTexture=l.createTexture();l.bindTexture(l.TEXTURE_2D,this.backgroundTexture);l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,1);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.LINEAR);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.LINEAR)},setTransparentTexture:function(){l.bindTexture(l.TEXTURE_2D,this.backgroundTexture);l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,m)},hideCssBackground:function(){var p=this.$el[0].style.backgroundImage;if(p=="none"){return}this.originalInlineCss=p;this.originalCssBackgroundImage=this.$el.css("backgroundImage");this.$el.css("backgroundImage","none")},restoreCssBackground:function(){this.$el.css("backgroundImage",this.originalInlineCss||"")},dropAtPointer:function(s,p,r){var q=parseInt(this.$el.css("border-left-width"))||0,t=parseInt(this.$el.css("border-top-width"))||0;this.drop(s.pageX-this.$el.offset().left-q,s.pageY-this.$el.offset().top-t,p,r)},drop:function(q,w,p,v){l=this.context;var t=this.$el.innerWidth();var r=this.$el.innerHeight();var u=Math.max(t,r);p=p/u;var s=new Float32Array([(2*q-t)/u,(r-2*w)/u]);l.viewport(0,0,this.resolution,this.resolution);l.bindFramebuffer(l.FRAMEBUFFER,this.framebuffers[this.bufferWriteIndex]);k(this.textures[this.bufferReadIndex]);l.useProgram(this.dropProgram.id);l.uniform2fv(this.dropProgram.locations.center,s);l.uniform1f(this.dropProgram.locations.radius,p);l.uniform1f(this.dropProgram.locations.strength,v);this.drawQuad();this.swapBufferIndices()},destroy:function(){this.$el.off(".ripples").removeClass("jquery-ripples").removeData("ripples");this.$canvas.remove();this.restoreCssBackground()},show:function(){this.visible=true;this.$canvas.show();this.hideCssBackground()},hide:function(){this.visible=false;this.$canvas.hide();this.restoreCssBackground()},pause:function(){this.running=false},play:function(){this.running=true},set:function(q,p){switch(q){case"dropRadius":case"perturbance":case"interactive":case"crossOrigin":this[q]=p;break;case"imageUrl":this.imageUrl=p;this.loadImage();break}}};var c=i.fn.ripples;i.fn.ripples=function(q){if(!d){throw new Error("Your browser does not support WebGL, the OES_texture_float extension or rendering to floating point textures.")}var p=(arguments.length>1)?Array.prototype.slice.call(arguments,1):undefined;return this.each(function(){var t=i(this),s=t.data("ripples"),r=i.extend({},a.DEFAULTS,t.data(),typeof q=="object"&&q);if(!s&&typeof q=="string"){return}if(!s){t.data("ripples",(s=new a(this,r)))}else{if(typeof q=="string"){a.prototype[q].apply(s,p)}}})};i.fn.ripples.Constructor=a;i.fn.ripples.noConflict=function(){i.fn.ripples=c;return this}}));